<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>聊天窗口界面</title>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" rel="stylesheet"/>
    <link rel="stylesheet" href="css/reset.min.css" th:href="@{/css/reset.min.css}" />
    <link rel="stylesheet" href="css/style.css" th:href="@{/css/style.css}"/>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

</head>
<body>

<div class="wrapper">
	<div class="container">
        <div class="left">
            <div class="top">
                <input type="text" placeholder="Search" />
                <a href="javascript:;" class="search"></a>
            </div>
            <input type="hidden" id="userpid"  th:value="${userpid}" />
            <ul class="people" >
                <li class="person" th:each="friend ,iterStat : ${firends}" th:onclick="getname([[${friend}]])">
                    <span class="name" th:text="${friend.pname}"></span>(<span class="name" th:text="${friend.pid}"></span>)
                </li>
            </ul>
        </div>
        <div id="showDiv" class="right" hidden>
            <div class="top"><span>To: <span class="name" style="align-content: center" id="toUser"></span></span></div>
            <div class="chat" style="overflow-y: auto;" id="message">
            </div>
            <div class="write">
                <a href="javascript:;" class="write-link attach"></a>
                <input type="text"  id="content" />
                <a href="javascript:;" class="write-link smiley"></a>
                <a href="javascript:;" class="write-link send" id="sendMsg"></a>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript"  src="js/webSocket.js" th:src="@{/js/webSocket.js}"></script>

<!--<div style="text-align:center;margin:1px 0; font:normal 14px/24px 'MicroSoft YaHei';">
<p>适用浏览器：360、FireFox、Chrome、Opera、傲游、搜狗、世界之窗. 不支持Safari、IE8及以下浏览器。</p>
<p>来源：<a href="http://sc.chinaz.com/" target="_blank">站长素材</a></p>
</div>-->
<script type="text/javascript">
    var receiveId;
    var send = $("#userpid").val();
    function getname(user){
        $("#message").empty()
        $("#showDiv").attr("hidden" , false)
        receiveId = user.pid
        $("#toUser").empty()
        $("#toUser").append(user.pname)
        //发送ajax请求，获取最近十条的信息
        $.ajax({
                url : "http://localhost:8080/msg/getMessage",
                type : "get",
                async : false,
                data : {
                    "sendId": send,
                    "receiveId" : receiveId
                },
                success : function (resp) {
                    console.info(resp)
                    //将信息添加到上边
                    for (var i = 0 ; i < resp.length ; i++){
                        var divClass = send == resp[i].sendId ? "bubble me" : "bubble you";
                        var strMessage = "<div class ='" + divClass + "'>" + new Date(resp[i].sendTime).Format("yyyy-MM-dd hh:mm:ss") + "<br>" + resp[i].message + "</div>"
                        $("#message").append(strMessage)
                    }
                    var strTime = "<div class='conversation-start'> <span>"+ new Date().Format("yyyy-MM-dd hh:mm:ss") +"</span></div>"
                    $("#message").append(strTime)
                },
                error : function (err) {
                    
                }
            })
    }


</script>
</body>
</html>